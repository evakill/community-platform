import{a as y,F as T,j as C}from"./jsx-runtime-93f93352.js";import{r}from"./index-ba39e096.js";import{h as F,E as $,c as B}from"./emotion-element-6a883da9.browser.esm-7636857e.js";import"./theme-ui-css.esm-b1576555.js";import{p as M}from"./parseProps-376f43a7.esm-266ad9ad.js";import{a as E,T as A,I as P}from"./theme-ui-components.esm-f3994bb3.js";function z(u,e,n){return F.call(e,"css")?y($,B(u,e),n):y(u,e,n)}var j=function(e,n,b){return z(e,M(n),b)};const O=u=>{const{results:e,callback:n,setShowResults:b}=u;return j(E,{"data-cy":"osm-geocoding-results",as:"ul",sx:{background:"white",padding:0,position:"relative",zIndex:1,margin:"-2px 0 0",border:"2px solid black",borderTopWidth:"1px",listStyle:"none",borderRadius:0,borderBottomLeftRadius:1,borderBottomRightRadius:1},children:e.map((a,d)=>j(E,{as:"li",sx:{paddingY:1,paddingX:2,lineHeight:1.5,"&:hover":{background:"softblue",cursor:"pointer"}},onClick:()=>{b(!1),n&&n(a)},children:a==null?void 0:a.display_name},d))})};try{O.displayName="OsmGeocodingResultsList",O.__docgenInfo={description:"",displayName:"OsmGeocodingResultsList",props:{results:{defaultValue:null,description:"",name:"results",required:!0,type:{name:"Result[]"}},callback:{defaultValue:null,description:"",name:"callback",required:!0,type:{name:"any"}},setShowResults:{defaultValue:null,description:"",name:"setShowResults",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}}}catch{}function D(u,e,n){var b=this,a=r.useRef(null),d=r.useRef(0),o=r.useRef(null),f=r.useRef([]),p=r.useRef(),x=r.useRef(),_=r.useRef(u),s=r.useRef(!0);r.useEffect(function(){_.current=u},[u]);var m=!e&&e!==0&&typeof window<"u";if(typeof u!="function")throw new TypeError("Expected a function");e=+e||0;var S=!!(n=n||{}).leading,k=!("trailing"in n)||!!n.trailing,g="maxWait"in n,h=g?Math.max(+n.maxWait||0,e):null;r.useEffect(function(){return s.current=!0,function(){s.current=!1}},[]);var L=r.useMemo(function(){var R=function(i){var c=f.current,V=p.current;return f.current=p.current=null,d.current=i,x.current=_.current.apply(V,c)},w=function(i,c){m&&cancelAnimationFrame(o.current),o.current=m?requestAnimationFrame(i):setTimeout(i,c)},t=function(i){if(!s.current)return!1;var c=i-a.current;return!a.current||c>=e||c<0||g&&i-d.current>=h},v=function(i){return o.current=null,k&&f.current?R(i):(f.current=p.current=null,x.current)},l=function i(){var c=Date.now();if(t(c))return v(c);if(s.current){var V=e-(c-a.current),I=g?Math.min(V,h-(c-d.current)):V;w(i,I)}},q=function(){var i=Date.now(),c=t(i);if(f.current=[].slice.call(arguments),p.current=b,a.current=i,c){if(!o.current&&s.current)return d.current=a.current,w(l,e),S?R(a.current):x.current;if(g)return w(l,e),R(a.current)}return o.current||w(l,e),x.current};return q.cancel=function(){o.current&&(m?cancelAnimationFrame(o.current):clearTimeout(o.current)),d.current=0,f.current=a.current=p.current=o.current=null},q.isPending=function(){return!!o.current},q.flush=function(){return o.current?v(Date.now()):x.current},q},[S,g,e,h,k,m]);return L}const N=()=>y(T,{children:y(E,{sx:{background:"white",position:"relative",zIndex:1,marginTop:"-2px",paddingX:2,paddingY:1,border:"2px solid",borderColor:"black",borderTopWidth:"1px",lineHeight:1.5,borderBottomLeftRadius:1,borderBottomRightRadius:1},children:y(A,{sx:{fontSize:1},children:"Fetching results from Open Street Map"})})}),G=({placeholder:u="Search for an address",debounceMs:e=800,callback:n,acceptLanguage:b="en",viewbox:a="",loading:d=!1})=>{const[o,f]=r.useState(""),[p,x]=r.useState([]),[_,s]=r.useState(!1),[m,S]=r.useState(d),[k,g]=r.useState(!1),h=r.useRef(null);document.addEventListener("click",function(t){var l;((l=h==null?void 0:h.current)==null?void 0:l.contains(t.target))||s(!1)}),document.onkeyup=function(t){t.key==="Escape"&&s(!1)};function L(t=""){if(t.length===0)return;S(!0);let v=`https://nominatim.openstreetmap.org/search?format=json&q=${t}&accept-language=${b}`;a.length&&(v=`${v}&viewbox=${a}&bounded=1`),fetch(v,{headers:new Headers({"User-Agent":"onearmy.earth Community Platform (https://platform.onearmy.earth)"})}).then(l=>l.json()).then(l=>{x(l),s(!0)}).catch(null).finally(()=>S(!1))}const R=!!p.length&&_&&!m,w=D(t=>L(t),e);return r.useEffect(()=>{k&&w(o)},[o,k]),C("div",{"data-cy":"osm-geocoding",ref:h,style:{width:"100%"},children:[y(P,{autoComplete:"off",type:"search",name:"geocoding",id:"geocoding","data-cy":"osm-geocoding-input",placeholder:u,value:o,style:{width:"100%",background:"white",fontFamily:"Varela Round",fontSize:"14px",border:"2px solid black",height:"44px",display:"flex",borderRadius:R||m?"5px 5px 0 0":"5px",marginBottom:0},onClick:()=>s(!0),onChange:t=>{g(!0),f(t.target.value)}}),m&&y(N,{}),R&&y(O,{results:p,callback:t=>{t&&(g(!1),f(t.display_name)),n(t)},setShowResults:s})]})};try{G.displayName="OsmGeocoding",G.__docgenInfo={description:"",displayName:"OsmGeocoding",props:{placeholder:{defaultValue:{value:"Search for an address"},description:"",name:"placeholder",required:!1,type:{name:"string"}},debounceMs:{defaultValue:{value:"800"},description:"",name:"debounceMs",required:!1,type:{name:"number"}},iconUrl:{defaultValue:null,description:"",name:"iconUrl",required:!1,type:{name:"string"}},callback:{defaultValue:null,description:"",name:"callback",required:!1,type:{name:"any"}},city:{defaultValue:null,description:"",name:"city",required:!1,type:{name:"string"}},countrycodes:{defaultValue:null,description:"",name:"countrycodes",required:!1,type:{name:"string"}},acceptLanguage:{defaultValue:{value:"en"},description:"",name:"acceptLanguage",required:!1,type:{name:"string"}},viewbox:{defaultValue:{value:""},description:"",name:"viewbox",required:!1,type:{name:"string"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}}}}}catch{}export{G as O,O as a};
//# sourceMappingURL=OsmGeocoding-cf91cc5b.js.map
